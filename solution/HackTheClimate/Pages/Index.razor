@page "/"
@using HackTheClimate.Services
@inject IJSRuntime JS;
@inject GraphService GraphService;

<h1>Search</h1>

<div class="input-group">
    <input bind="@SearchTerm" type="text" class="form-control" placeholder="Search laws and policies" @onkeyup="OnInputKeyUp">
    <div class="input-group-append">
        <button class="btn btn-secondary" type="button" @onclick="Search">
            <i class="oi oi-magnifying-glass"></i>
        </button>
    </div>
</div>

@if (_searching)
{
    <div class="spinner-border" role="status">
        <span class="sr-only">Loading...</span>
    </div>
}

<svg @ref="_renderTo" height="450" width="600"></svg>

@code {
    private ElementReference _renderTo;
    protected string SearchTerm { get; set;}
    protected bool _searching = false;

    private async Task OnInputKeyUp(KeyboardEventArgs e)
    {
        if (e.Key == "Enter" || e.Code == "13")
        {
            await Search();
        }
    }

    private async Task Search()
    {
        _searching = true;

        var graph = await GraphService.SearchAsync(SearchTerm);

        var diagramModule = await JS
        .InvokeAsync<IJSObjectReference>("import", "/diagram.js");

        await diagramModule.InvokeVoidAsync("renderDiagram", _renderTo, graph.Graph);

        _searching = false;
    }
}